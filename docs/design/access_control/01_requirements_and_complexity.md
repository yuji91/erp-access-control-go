# 🎯 権限管理システムの複雑さ評価
（TODO: 上のアイコン、もっと検討するニュアンス出したい）

調査結果を基に、このシステムの権限管理の複雑さを詳細に分析します。

## 📈 他システムとの比較

| システム例 | 複雑さレベル | 特徴 |
|------------|-------------|------|
| 基本ブログシステム | ⭐ | admin/user の2ロールのみ |
| ECサイト | ⭐⭐ | customer/staff/admin の3ロール |
| 一般的なCMS | ⭐⭐⭐ | 5-10ロール、リソース別権限 |
| ERPシステム | ⭐⭐⭐⭐ | 部門別、機能別の複合権限 |
| より複雑な例 | ⭐⭐⭐⭐⭐ | 多次元権限マトリックス |

ERPシステムにおける「⭐⭐⭐⭐：部門別、機能別の複合権限」という複雑さレベルは、**中〜高難度のRBAC（Role-Based Access Control）** が必要とされることを意味します。以下に、ERPに特有の権限管理要件を具体的に整理します。

---

## 🎯 ERPシステムにおける権限管理の想定要件

### 1. 部門別のアクセス制御

部門単位でのデータ隔離と操作制限

各ユーザーは「所属部門」によってアクセス可能なリソースが変化する

**✅ 例**

- 営業部は「受注管理」「顧客情報」を閲覧・編集可能
- 経理部は「請求書」「売上報告」のみ編集可能
- 管理部は全体を監査可能だが、直接編集はできない

### 2. 機能別のアクション制御

各業務機能（モジュール）ごとにread / write / delete / export などの操作権限を定義

**✅ 例**

- 「在庫管理」モジュールでは `view_inventory`, `update_inventory`, `export_report` の権限
- 「人事管理」モジュールでは `view_profile`, `edit_profile`, `approve_leave` の権限

### 3. ロールの階層構造（Role Hierarchy）

権限は単純なフラットロールではなく、上位ロールが下位ロールを包含する階層構造を取る

**✅ 例**

- `employee` < `supervisor` < `department_manager` < `admin`
- `department_manager` は自部署のメンバーの操作権限を持つ

### 4. リソーススコープ制御（スコープベース）

同一機能であっても、ユーザーごとにアクセス可能なデータ範囲が異なる

**✅ 例**

- 営業部Aと営業部Bで Customer モデルの一覧表示に出るデータが異なる（スコープフィルタ）
- 「営業拠点」「部署」「プロジェクト単位」などでフィルタ制御が必要

### 5. 時間・状態・組織構成に基づく動的制御（準ABAC）

「申請中」「承認済」「締切後」など状態に応じた操作制限

組織構成の変更によって動的に権限を再構成

**✅ 例**

- 承認フローで「一次承認者」「二次承認者」「差戻し権限者」が変動する
- 休職中ユーザーは操作権限が自動で一時無効化される

### 6. 監査性・ログトレース性の確保

どのユーザーが「どのデータ」に「何をしたか」を明確に記録

「なぜ拒否されたか」を説明できるロジックも必要（アクセス理由の明示）

## 📊 まとめ：ERPにおける権限管理の主な特性

| 要素 | 説明例 |
|------|--------|
| ✅ 部門ベース制御 | 所属部署ごとのアクセス制限 |
| ✅ 機能ごとのアクション権限 | モジュール単位の操作権限 |
| ✅ 階層ロール | 上位ロールが下位ロールを内包 |
| ✅ スコープ制御 | 担当エリア・拠点・プロジェクトなどで制限 |
| ✅ 動的ABAC的要素 | 状態・時間・役職などに応じて条件付きアクセス |
| ✅ トレース・説明可能性の要求 | なぜ拒否されたか、どのルールで許可されたかの説明が可能 |

### ✍️ 補足：RBACとの違いが強く出る場面

| シーン | RBACのみ | ABAC必要 |
|--------|----------|----------|
| 所属部門に基づく一覧の絞り込み | ✅ | ✅ |
| 業務フロー中の承認者制御 | △（動的ロール管理） | ✅ |
| 一時的なアクセス許可 | 🔺（temporary role追加） | ✅（属性で表現） |
| 時間帯によるアクセス制限 | ❌ | ✅ |

## ✅ 結論

ERPシステムでは、部門別・機能別の複合制御が標準要件であり、RBACベースにスコープ制御・状態制御・階層ロールなどを加えた設計が必要です。

さらに動的条件が多い場合、部分的にABAC（もしくはABACハイブリッド構成）を導入することで、より実用的かつ安全な権限管理が実現できます。
