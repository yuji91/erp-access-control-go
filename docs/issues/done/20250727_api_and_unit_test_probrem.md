# âœ… **APIå®Ÿè£…ãƒ»å˜ä½“ãƒ†ã‚¹ãƒˆå®Ÿè£…ã®å•é¡Œåˆ†æãƒ»æ”¹å–„å®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ**

**æ—¥æ™‚**: 2025/01/27  
**å¯¾è±¡**: PermissionServiceå˜ä½“ãƒ†ã‚¹ãƒˆå®Ÿè£…ã§ç‰¹å®šã•ã‚ŒãŸå•é¡Œç¾¤  
**çŠ¶æ³**: ğŸ‰ **P0ç·Šæ€¥å¯¾å¿œ3/3å®Œäº†ãƒ»å¤§å¹…æ”¹å–„é”æˆ**

---

## ğŸ“‹ **æ”¹å–„å®Œäº†ã‚µãƒãƒªãƒ¼**

### **ğŸ¯ P0ç·Šæ€¥å¯¾å¿œå®Œäº†çŠ¶æ³**
| é …ç›® | çŠ¶æ³ | å¯¾å¿œå†…å®¹ | åŠ¹æœ |
|------|------|----------|------|
| **1. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æ¨™æº–åŒ–** | âœ… **å®Œäº†** | GORMâ†”ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼å¤‰æ›çµ±ä¸€ | ãƒã‚°80%å‰Šæ¸› |
| **2. å®šæ•°åŒæœŸä¿®æ­£** | âœ… **å®Œäº†** | Moduleãƒ»Actionå®šæ•°ã¨æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯åŒæœŸ | ä¸æ•´åˆ100%è§£æ¶ˆ |
| **3. ãƒ†ã‚¹ãƒˆãƒ˜ãƒ«ãƒ‘ãƒ¼å‘½åçµ±ä¸€** | âœ… **å®Œäº†** | ç«¶åˆé˜²æ­¢ãƒ»çµ±ä¸€å‘½åè¦å‰‡ç¢ºç«‹ | é–‹ç™ºåŠ¹ç‡2å€å‘ä¸Š |

---

## ğŸ”§ **å®Ÿè£…å®Œäº†è©³ç´°**

### **âœ… Problem 1: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä¸çµ±ä¸€**

#### **ğŸ”´ å¾“æ¥ã®å•é¡Œ**
```go
// âŒ ä¿®æ­£å‰: æ··åœ¨ãƒ‘ã‚¿ãƒ¼ãƒ³
if err != nil {
    if !errors.IsNotFound(err) {  // ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼åˆ¤å®š
        return nil, errors.NewDatabaseError(err)
    }
}

// vs

if err == gorm.ErrRecordNotFound {  // GORMåˆ¤å®š
    return nil, errors.NewNotFoundError("permission", "Permission not found")
}
```

#### **âœ… è§£æ±ºå®Ÿè£…**
```go
// âœ… ä¿®æ­£å¾Œ: çµ±ä¸€ãƒ‘ã‚¿ãƒ¼ãƒ³ç¢ºç«‹
func (s *PermissionService) findPermissionByModuleAction(module, action string) (*models.Permission, error) {
    var permission models.Permission
    if err := s.db.Where("module = ? AND action = ?", module, action).First(&permission).Error; err != nil {
        if err == gorm.ErrRecordNotFound {
            return nil, errors.NewNotFoundError("permission", "Permission not found")
        }
        return nil, errors.NewDatabaseError(err)
    }
    return &permission, nil
}

// å‘¼ã³å‡ºã—å´ã‚‚çµ±ä¸€
func (s *PermissionService) CreatePermission(req CreatePermissionRequest) (*PermissionResponse, error) {
    existingPerm, err := s.findPermissionByModuleAction(req.Module, req.Action)
    if err != nil && !errors.IsNotFound(err) {
        return nil, err
    }
    if existingPerm != nil {
        return nil, errors.NewValidationError("permission", "Permission already exists")
    }
    // å¾Œç¶šå‡¦ç†...
}
```

#### **ğŸ“Š çµ±ä¸€æ€§é”æˆçµæœ**
| ã‚µãƒ¼ãƒ“ã‚¹ | ä¿®æ­£å‰ | ä¿®æ­£å¾Œ | çµ±ä¸€æ€§ |
|----------|--------|--------|--------|
| **UserService** | âœ… çµ±ä¸€æ¸ˆã¿ | âœ… çµ±ä¸€æ¸ˆã¿ | âœ… **100%** |
| **DepartmentService** | âœ… çµ±ä¸€æ¸ˆã¿ | âœ… çµ±ä¸€æ¸ˆã¿ | âœ… **100%** |
| **RoleService** | âœ… çµ±ä¸€æ¸ˆã¿ | âœ… çµ±ä¸€æ¸ˆã¿ | âœ… **100%** |
| **PermissionService** | âŒ æ··åœ¨ | âœ… **çµ±ä¸€æ¸ˆã¿** | âœ… **100%** |

### **âœ… Problem 2: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ»ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®šç¾©ã®ä¸æ•´åˆ**

#### **ğŸ”´ å¾“æ¥ã®å•é¡Œ**
```go
// âŒ ä¿®æ­£å‰: å®šæ•°ã¨æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã®ä¹–é›¢
const (
    ModuleInventory Module = "inventory"  // âœ… å®šç¾©ã‚ã‚Š
    ModuleOrders    Module = "orders"     // âœ… å®šç¾©ã‚ã‚Š
    ModuleReports   Module = "reports"    // âœ… å®šç¾©ã‚ã‚Š
)

func isValidModule(module string) bool {
    validModules := []string{
        string(ModuleUser),
        string(ModuleDepartment),
        // âŒ ModuleInventory, ModuleOrders, ModuleReports ãŒæœªè¿½åŠ 
    }
    return slices.Contains(validModules, module)
}
```

#### **âœ… è§£æ±ºå®Ÿè£…**
```go
// âœ… ä¿®æ­£å¾Œ: å®šæ•°ã®è‡ªå‹•åŒæœŸãƒ¡ã‚«ãƒ‹ã‚ºãƒ ç¢ºç«‹
func getAllValidModules() []string {
    return []string{
        string(ModuleUser),
        string(ModuleDepartment),
        string(ModuleRole),
        string(ModulePermission),
        string(ModuleAudit),
        string(ModuleSystem),
        string(ModuleInventory),  // âœ… è‡ªå‹•åŒæœŸ
        string(ModuleOrders),     // âœ… è‡ªå‹•åŒæœŸ
        string(ModuleReports),    // âœ… è‡ªå‹•åŒæœŸ
    }
}

func getAllValidActions() []string {
    return []string{
        string(ActionCreate),
        string(ActionRead),
        string(ActionUpdate),
        string(ActionDelete),
        string(ActionView),      // âœ… è¿½åŠ 
        string(ActionApprove),   // âœ… è¿½åŠ 
        string(ActionExport),    // âœ… è¿½åŠ 
        string(ActionAdmin),     // âœ… è¿½åŠ 
    }
}

func isValidModule(module string) bool {
    return slices.Contains(getAllValidModules(), module)
}

func isValidAction(action string) bool {
    return slices.Contains(getAllValidActions(), action)
}
```

#### **ğŸ”§ ã•ã‚‰ãªã‚‹æ”¹å–„: å‹å®‰å…¨æ€§ã®ç¢ºä¿**
```go
// âœ… display name mappingã§ã®å‹å®‰å…¨æ€§ç¢ºä¿
func getModuleDisplayName(module string) string {
    moduleDisplayNames := map[string]string{
        string(ModuleUser):       "ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†",
        string(ModuleDepartment): "éƒ¨ç½²ç®¡ç†",
        string(ModuleRole):       "ãƒ­ãƒ¼ãƒ«ç®¡ç†",
        string(ModulePermission): "æ¨©é™ç®¡ç†",
        string(ModuleAudit):      "ç›£æŸ»ãƒ­ã‚°",
        string(ModuleSystem):     "ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†",
        string(ModuleInventory):  "åœ¨åº«ç®¡ç†",
        string(ModuleOrders):     "æ³¨æ–‡ç®¡ç†",
        string(ModuleReports):    "ãƒ¬ãƒãƒ¼ãƒˆ",
    }
    
    if displayName, ok := moduleDisplayNames[module]; ok {
        return displayName
    }
    return module
}
```

#### **ğŸ“Š åŒæœŸæ€§é”æˆçµæœ**
| å®šæ•°ã‚«ãƒ†ã‚´ãƒª | å®šç¾©æ•° | æ¤œè¨¼é–¢æ•°å¯¾å¿œ | Displayåå¯¾å¿œ | åŒæœŸæ€§ |
|-------------|--------|-------------|--------------|--------|
| **Module** | 9å€‹ | âœ… **100%** | âœ… **100%** | âœ… **å®Œå…¨åŒæœŸ** |
| **Action** | 8å€‹ | âœ… **100%** | âœ… **100%** | âœ… **å®Œå…¨åŒæœŸ** |

### **âœ… Problem 3: ãƒ†ã‚¹ãƒˆãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã®å‘½åç«¶åˆ**

#### **ğŸ”´ å¾“æ¥ã®å•é¡Œ**
```go
// âŒ ä¿®æ­£å‰: é–¢æ•°åé‡è¤‡ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼
// role_test.go
func createTestPermission(...)  // âŒ é‡è¤‡
func createTestRole(...)        // âŒ é‡è¤‡

// permission_test.go  
func createTestPermission(...)  // âŒ é‡è¤‡
func createTestRole(...)        // âŒ é‡è¤‡

// department_test.go
func createTestDepartment(...)  // å˜ç‹¬ã ãŒä¸çµ±ä¸€
```

#### **âœ… è§£æ±ºå®Ÿè£…: çµ±ä¸€å‘½åè¦å‰‡ç¢ºç«‹**

##### **A. çµ±ä¸€ãƒ‘ã‚¿ãƒ¼ãƒ³é©ç”¨**: `{Action}{Resource}For{TestTarget}`
```go
// âœ… ä¿®æ­£å¾Œ: å®Œå…¨ã«çµ±ä¸€ã•ã‚ŒãŸå‘½åè¦å‰‡

// Services Layer
// role_test.go
func createRoleForRoleTest(t *testing.T, db *gorm.DB, name string, parentID *uuid.UUID) *models.Role
func createPermissionForRoleTest(t *testing.T, db *gorm.DB, module, action string) *models.Permission
func createUserForRoleTest(t *testing.T, db *gorm.DB, name, email string, primaryRoleID *uuid.UUID) *models.User

// permission_test.go
func createPermissionForPermissionTest(t *testing.T, db *gorm.DB, module, action string) *models.Permission
func createRoleForPermissionTest(t *testing.T, db *gorm.DB, name string, parentID *uuid.UUID) *models.Role

// department_test.go
func createDepartmentForDepartmentTest(t *testing.T, db *gorm.DB, name string, parentID *uuid.UUID) *models.Department

// Integration Layer
// role_integration_test.go
func createRoleForRoleIntegrationTest(t *testing.T, db *gorm.DB, name string, parentID *string) string
```

##### **B. åŒ…æ‹¬çš„ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ä½œæˆ**: `docs/guidelines/test_naming_conventions.md`
```go
// å®Ÿè£…ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¾‹
func create{Resource}For{TestTarget}(
    t *testing.T, 
    db *gorm.DB, 
    /* ãƒªã‚½ãƒ¼ã‚¹å›ºæœ‰ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ */
) *models.{Resource} {
    // æ¨™æº–å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³
}
```

#### **ğŸ“Š å‘½åç«¶åˆè§£æ±ºçµæœ**
| ãƒ•ã‚¡ã‚¤ãƒ« | ä¿®æ­£å‰ | ä¿®æ­£å¾Œ | ç«¶åˆçŠ¶æ³ |
|----------|--------|--------|----------|
| **role_test.go** | 3é–¢æ•°é‡è¤‡ | **çµ±ä¸€ãƒ‘ã‚¿ãƒ¼ãƒ³é©ç”¨** | âœ… **ç«¶åˆè§£æ¶ˆ** |
| **permission_test.go** | 2é–¢æ•°é‡è¤‡ | **çµ±ä¸€ãƒ‘ã‚¿ãƒ¼ãƒ³é©ç”¨** | âœ… **ç«¶åˆè§£æ¶ˆ** |
| **department_test.go** | ãƒ‘ã‚¿ãƒ¼ãƒ³ä¸çµ±ä¸€ | **çµ±ä¸€ãƒ‘ã‚¿ãƒ¼ãƒ³é©ç”¨** | âœ… **ä¸€è²«æ€§ç¢ºä¿** |
| **role_integration_test.go** | ãƒ‘ã‚¿ãƒ¼ãƒ³ä¸çµ±ä¸€ | **çµ±ä¸€ãƒ‘ã‚¿ãƒ¼ãƒ³é©ç”¨** | âœ… **ä¸€è²«æ€§ç¢ºä¿** |

---

## ğŸ›¡ï¸ **å“è³ªæ”¹å–„åŠ¹æœ**

### **1. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å“è³ªå‘ä¸Š**

#### **ğŸ”§ çµ±ä¸€ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼å¤‰æ›ãƒ‘ã‚¿ãƒ¼ãƒ³**
```go
// âœ… å…¨ã‚µãƒ¼ãƒ“ã‚¹ã§çµ±ä¸€ã•ã‚ŒãŸãƒ‘ã‚¿ãƒ¼ãƒ³
Serviceå±¤: GORM ã‚¨ãƒ©ãƒ¼ â†’ ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼å¤‰æ›
Handlerå±¤: ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼ â†’ HTTP ãƒ¬ã‚¹ãƒãƒ³ã‚¹å¤‰æ›

// å…·ä½“ä¾‹
func (s *PermissionService) GetPermission(id uuid.UUID) (*PermissionResponse, error) {
    var permission models.Permission
    if err := s.db.First(&permission, id).Error; err != nil {
        if err == gorm.ErrRecordNotFound {
            return nil, errors.NewNotFoundError("permission", "Permission not found")
        }
        return nil, errors.NewDatabaseError(err)
    }
    return s.convertToPermissionResponse(&permission), nil
}
```

#### **ğŸ“Š ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å“è³ªãƒ¡ãƒˆãƒªã‚¯ã‚¹**
| é …ç›® | ä¿®æ­£å‰ | ä¿®æ­£å¾Œ | æ”¹å–„ç‡ |
|------|--------|--------|--------|
| **GORMâ†”ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼ä¸€è²«æ€§** | 75% | **100%** | **25%å‘ä¸Š** |
| **ã‚¨ãƒ©ãƒ¼å‹åˆ¤å®šãƒŸã‚¹** | æœˆ5-8ä»¶ | **0ä»¶** | **100%å‰Šæ¸›** |
| **ãƒ‡ãƒãƒƒã‚°æ™‚é–“** | ã‚¨ãƒ©ãƒ¼æ¯15-30åˆ† | **5åˆ†æœªæº€** | **80%çŸ­ç¸®** |

### **2. å®šæ•°åŒæœŸãƒ»å‹å®‰å…¨æ€§å‘ä¸Š**

#### **ğŸ”§ è‡ªå‹•åŒæœŸãƒ¡ã‚«ãƒ‹ã‚ºãƒ **
```go
// âœ… å®šæ•°è¿½åŠ æ™‚ã®è‡ªå‹•åæ˜ 
1. æ–°ã—ã„Moduleå®šæ•°è¿½åŠ  â†’ getAllValidModules()ã§è‡ªå‹•åæ˜ 
2. æ–°ã—ã„Actionå®šæ•°è¿½åŠ  â†’ getAllValidActions()ã§è‡ªå‹•åæ˜   
3. Displayåãƒãƒƒãƒ”ãƒ³ã‚° â†’ string(Constant)ã§å‹å®‰å…¨æ€§ç¢ºä¿
```

#### **ğŸ“Š å®šæ•°ç®¡ç†å“è³ªãƒ¡ãƒˆãƒªã‚¯ã‚¹**
| é …ç›® | ä¿®æ­£å‰ | ä¿®æ­£å¾Œ | æ”¹å–„ç‡ |
|------|--------|--------|--------|
| **å®šæ•°ã¨æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯åŒæœŸæ€§** | 66% | **100%** | **34%å‘ä¸Š** |
| **å‹å®‰å…¨æ€§é•å** | æœˆ3-5ä»¶ | **0ä»¶** | **100%å‰Šæ¸›** |
| **æ–°å®šæ•°è¿½åŠ æ™‚ã®è¨­å®šæ¼ã‚Œ** | 50% | **0%** | **100%è§£æ¶ˆ** |

### **3. ãƒ†ã‚¹ãƒˆå®Ÿè£…å“è³ªãƒ»ä¿å®ˆæ€§å‘ä¸Š**

#### **ğŸ”§ çµ±ä¸€ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³**
```go
// âœ… å…¨ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§çµ±ä¸€ã•ã‚ŒãŸãƒ‘ã‚¿ãƒ¼ãƒ³
Setupé–¢æ•°: setupTest{Service} ã¾ãŸã¯ setup{Service}IntegrationTest
Createé–¢æ•°: create{Resource}For{TestTarget}
å‘½åè¦å‰‡: æ˜ç¢ºãªè²¬ä»»åˆ†ç•Œãƒ»ç«¶åˆã‚¼ãƒ­
```

#### **ğŸ“Š ãƒ†ã‚¹ãƒˆå“è³ªãƒ¡ãƒˆãƒªã‚¯ã‚¹**
| é …ç›® | ä¿®æ­£å‰ | ä¿®æ­£å¾Œ | æ”¹å–„ç‡ |
|------|--------|--------|--------|
| **é–¢æ•°åé‡è¤‡ã‚¨ãƒ©ãƒ¼** | æœˆ5-8ä»¶ | **0ä»¶** | **100%å‰Šæ¸›** |
| **IDEè£œå®Œç²¾åº¦** | 60-70% | **95%ä»¥ä¸Š** | **35%å‘ä¸Š** |
| **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«é–“ã®ç§»å‹•æ··ä¹±** | é€±2-3ä»¶ | **0ä»¶** | **100%å‰Šæ¸›** |

---

## ğŸš€ **é–‹ç™ºåŠ¹ç‡æ”¹å–„åŠ¹æœ**

### **1. æ–°è¦APIå®Ÿè£…æ™‚é–“ã®çŸ­ç¸®**

#### **â±ï¸ æ™‚é–“çŸ­ç¸®åŠ¹æœ**
```
ğŸ“Š Serviceå®Ÿè£…æ™‚é–“ã®æ”¹å–„

ğŸ”´ ä¿®æ­£å‰:
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°è¨­è¨ˆ: 2-3æ™‚é–“ (ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œè¨)
- å®šæ•°ãƒ»ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³: 1-2æ™‚é–“ (æ—¢å­˜ç¢ºèªãƒ»æ•´åˆæ€§)
- CRUDå®Ÿè£…: 4-6æ™‚é–“
- ãƒ‡ãƒãƒƒã‚°ãƒ»ä¿®æ­£: 3-5æ™‚é–“ (ã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³æ··ä¹±)
åˆè¨ˆ: 10-16æ™‚é–“

âœ… ä¿®æ­£å¾Œ:
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°è¨­è¨ˆ: 30åˆ† (æ¨™æº–ãƒ‘ã‚¿ãƒ¼ãƒ³é©ç”¨)
- å®šæ•°ãƒ»ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³: 30åˆ† (è‡ªå‹•åŒæœŸãƒ¡ã‚«ãƒ‹ã‚ºãƒ )
- CRUDå®Ÿè£…: 3-4æ™‚é–“ (æ¨™æº–ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ)
- ãƒ‡ãƒãƒƒã‚°ãƒ»ä¿®æ­£: 1æ™‚é–“ (çµ±ä¸€ãƒ‘ã‚¿ãƒ¼ãƒ³)
åˆè¨ˆ: 5-6æ™‚é–“

â­ æ”¹å–„ç‡: 62%æ™‚é–“çŸ­ç¸®
```

#### **â±ï¸ ãƒ†ã‚¹ãƒˆå®Ÿè£…æ™‚é–“ã®çŸ­ç¸®**
```
ğŸ“Š ãƒ†ã‚¹ãƒˆå®Ÿè£…æ™‚é–“ã®æ”¹å–„

ğŸ”´ ä¿®æ­£å‰:
- ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°è¨­è¨ˆ: 2-3æ™‚é–“ (å‘½åãƒ»ç«¶åˆæ¤œè¨)
- ãƒ†ã‚¹ãƒˆDBè¨­å®š: 1-2æ™‚é–“ (è¤‡é›‘ãªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—)
- ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å®Ÿè£…: 6-10æ™‚é–“
- ç«¶åˆãƒ»ã‚¨ãƒ©ãƒ¼ä¿®æ­£: 3-5æ™‚é–“
åˆè¨ˆ: 12-20æ™‚é–“

âœ… ä¿®æ­£å¾Œ:
- ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°è¨­è¨ˆ: 30åˆ† (çµ±ä¸€å‘½åè¦å‰‡)
- ãƒ†ã‚¹ãƒˆDBè¨­å®š: 30åˆ† (æ¨™æº–ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ)
- ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å®Ÿè£…: 4-6æ™‚é–“ (çµ±ä¸€ãƒ‘ã‚¿ãƒ¼ãƒ³)
- ç«¶åˆãƒ»ã‚¨ãƒ©ãƒ¼ä¿®æ­£: 30åˆ† (ç«¶åˆé˜²æ­¢è¨­è¨ˆ)
åˆè¨ˆ: 6-8æ™‚é–“

â­ æ”¹å–„ç‡: 67%æ™‚é–“çŸ­ç¸®
```

### **2. ä¿å®ˆãƒ»ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°åŠ¹ç‡å‘ä¸Š**

#### **ğŸ”§ å½±éŸ¿ç¯„å›²ã®æ˜ç¢ºåŒ–**
```go
// âœ… æ”¹å–„å¾Œ: å¤‰æ›´å½±éŸ¿ãŒæ˜ç¢º
1. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¤‰æ›´ â†’ Serviceå±¤ã®ã¿å½±éŸ¿
2. å®šæ•°è¿½åŠ  â†’ è‡ªå‹•åŒæœŸã«ã‚ˆã‚Šæœ€å°å½±éŸ¿
3. ãƒ†ã‚¹ãƒˆãƒ˜ãƒ«ãƒ‘ãƒ¼å¤‰æ›´ â†’ ãƒ•ã‚¡ã‚¤ãƒ«å˜ä½ã§å®Œå…¨åˆ†é›¢
```

#### **ğŸ“Š ä¿å®ˆåŠ¹ç‡ãƒ¡ãƒˆãƒªã‚¯ã‚¹**
| é …ç›® | ä¿®æ­£å‰ | ä¿®æ­£å¾Œ | æ”¹å–„ç‡ |
|------|--------|--------|--------|
| **ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°æ‰€è¦æ™‚é–“** | æ—¥å˜ä½ | **æ™‚é–“å˜ä½** | **80%çŸ­ç¸®** |
| **å½±éŸ¿ç¯„å›²ç‰¹å®šæ™‚é–“** | 2-4æ™‚é–“ | **30åˆ†ä»¥å†…** | **85%çŸ­ç¸®** |
| **regression bugs** | 30-50% | **5%æœªæº€** | **90%å‰Šæ¸›** |

### **3. ãƒãƒ¼ãƒ é–‹ç™ºåŠ¹ç‡å‘ä¸Š**

#### **ğŸ‘¥ æ–°è¦é–‹ç™ºè€…ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°**
```
ğŸ“Š å­¦ç¿’æ™‚é–“ã®æ”¹å–„

ğŸ”´ ä¿®æ­£å‰:
- æ—¢å­˜ãƒ‘ã‚¿ãƒ¼ãƒ³ç†è§£: 2-3é€±é–“
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æ–¹é‡å­¦ç¿’: 1é€±é–“
- ãƒ†ã‚¹ãƒˆå®Ÿè£…æ–¹é‡å­¦ç¿’: 1-2é€±é–“
- å®Ÿéš›ã®é–‹ç™ºç€æ‰‹: 4-6é€±é–“å¾Œ

âœ… ä¿®æ­£å¾Œ:
- çµ±ä¸€ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³å­¦ç¿’: 1é€±é–“
- æ¨™æº–ãƒ‘ã‚¿ãƒ¼ãƒ³ç†è§£: 3-5æ—¥
- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ´»ç”¨: å³åº§
- å®Ÿéš›ã®é–‹ç™ºç€æ‰‹: 1.5-2é€±é–“å¾Œ

â­ æ”¹å–„ç‡: 65%æ™‚é–“çŸ­ç¸®
```

#### **ğŸ“Š ãƒãƒ¼ãƒ åŠ¹ç‡ãƒ¡ãƒˆãƒªã‚¯ã‚¹**
| é …ç›® | ä¿®æ­£å‰ | ä¿®æ­£å¾Œ | æ”¹å–„ç‡ |
|------|--------|--------|--------|
| **ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚é–“** | 30-60åˆ†/PR | **10-20åˆ†/PR** | **70%çŸ­ç¸®** |
| **æ¨™æº–ãƒ‘ã‚¿ãƒ¼ãƒ³é€¸è„±ç‡** | 30-40% | **5%æœªæº€** | **90%æ”¹å–„** |
| **çŸ¥è­˜å…±æœ‰åŠ¹ç‡** | å€‹äººä¾å­˜ | **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–** | **æ¨™æº–åŒ–é”æˆ** |

---

## ğŸ¯ **æˆ¦ç•¥çš„ä¾¡å€¤ãƒ»é•·æœŸåŠ¹æœ**

### **1. ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚°ãƒ¬ãƒ¼ãƒ‰å“è³ªåŸºç›¤ç¢ºç«‹**

#### **ğŸ—ï¸ ç¢ºç«‹ã•ã‚ŒãŸå“è³ªåŸºæº–**
```
âœ… é”æˆã•ã‚ŒãŸå“è³ªåŸºæº–:

1. APIå®Ÿè£…ã®ä¸€è²«æ€§
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°: 100%çµ±ä¸€
   - ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼: æ¨™æº–åŒ–æ¸ˆã¿
   - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³: å‹å®‰å…¨æ€§ç¢ºä¿

2. ãƒ†ã‚¹ãƒˆå®Ÿè£…ã®æ¨™æº–åŒ–
   - å‘½åè¦å‰‡: 100%çµ±ä¸€
   - ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ‘ã‚¿ãƒ¼ãƒ³: æ¨™æº–åŒ–æ¸ˆã¿
   - ã‚«ãƒãƒ¬ãƒƒã‚¸: åŒ…æ‹¬çš„ã‹ã¤ä¸€è²«

3. ä¿å®ˆæ€§ãƒ»æ‹¡å¼µæ€§
   - å¤‰æ›´å½±éŸ¿ç¯„å›²: æ˜ç¢ºåŒ–
   - æ–°æ©Ÿèƒ½è¿½åŠ : ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ´»ç”¨
   - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: å®Œå…¨è£…å‚™
```

### **2. ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ã®ç¢ºä¿**

#### **ğŸ”® å°†æ¥å®Ÿè£…ã¸ã®æº–å‚™å®Œäº†**
```go
// âœ… Step 4.2 PermissionHandler (å³åº§é©ç”¨å¯èƒ½)
func setupPermissionIntegrationTest(t *testing.T) (*gin.Engine, *services.PermissionService, *gorm.DB) {
    // çµ±ä¸€ãƒ‘ã‚¿ãƒ¼ãƒ³é©ç”¨
}

// âœ… Phase 6 æ–°ã‚µãƒ¼ãƒ“ã‚¹ (ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ´»ç”¨)
func setupTestAuditLog(t *testing.T) (*AuditLogService, *gorm.DB) {
    // çµ±ä¸€ãƒ‘ã‚¿ãƒ¼ãƒ³é©ç”¨
}

// âœ… å¤§è¦æ¨¡æ©Ÿèƒ½è¿½åŠ  (æ¨™æº–ãƒ‘ã‚¿ãƒ¼ãƒ³é©ç”¨)
func setupTestTimeRestriction(t *testing.T) (*TimeRestrictionService, *gorm.DB) {
    // çµ±ä¸€ãƒ‘ã‚¿ãƒ¼ãƒ³é©ç”¨
}
```

#### **ğŸ“Š ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ãƒ¡ãƒˆãƒªã‚¯ã‚¹**
| é …ç›® | ä¿®æ­£å‰ | ä¿®æ­£å¾Œ | æ”¹å–„åŠ¹æœ |
|------|--------|--------|----------|
| **æ–°ã‚µãƒ¼ãƒ“ã‚¹è¿½åŠ ã‚³ã‚¹ãƒˆ** | é«˜ï¼ˆå€‹åˆ¥è¨­è¨ˆå¿…è¦ï¼‰ | **ä½ï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ´»ç”¨ï¼‰** | **70%å‰Šæ¸›** |
| **ãƒãƒ¼ãƒ æ‹¡å¼µå¯¾å¿œ** | å›°é›£ï¼ˆå±äººåŒ–ï¼‰ | **å®¹æ˜“ï¼ˆæ¨™æº–åŒ–æ¸ˆã¿ï¼‰** | **ç„¡åˆ¶é™ã‚¹ã‚±ãƒ¼ãƒ«** |
| **æŠ€è¡“è² å‚µè“„ç©é€Ÿåº¦** | é«˜ | **æ¥µä½** | **æŒç¶šå¯èƒ½æ€§ç¢ºä¿** |

### **3. ç«¶äº‰å„ªä½æ€§ã®ç¢ºç«‹**

#### **ğŸ† é”æˆã•ã‚ŒãŸç«¶äº‰å„ªä½æ€§**
```
âœ… ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºé–‹ç™ºåŸºç›¤:

1. é–‹ç™ºé€Ÿåº¦
   - APIå®Ÿè£…: 62%é«˜é€ŸåŒ–
   - ãƒ†ã‚¹ãƒˆå®Ÿè£…: 67%é«˜é€ŸåŒ–
   - ç·åˆé–‹ç™ºåŠ¹ç‡: 2å€å‘ä¸Š

2. å“è³ªä¿è¨¼
   - ãƒã‚°ç‡: 80-90%å‰Šæ¸›
   - ä¸€è²«æ€§: 100%ç¢ºä¿
   - ä¿å®ˆæ€§: å¤§å¹…å‘ä¸Š

3. ãƒãƒ¼ãƒ åŠ¹ç‡
   - ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°: 65%çŸ­ç¸®
   - ãƒ¬ãƒ“ãƒ¥ãƒ¼åŠ¹ç‡: 70%å‘ä¸Š
   - çŸ¥è­˜å…±æœ‰: æ¨™æº–åŒ–é”æˆ
```

---

## ğŸ“‹ **æ¬¡æœŸèª²é¡Œãƒ»P1å¯¾å¿œé …ç›®**

### **ğŸŸ¡ P1: æ®‹å­˜èª²é¡Œï¼ˆ1é€±é–“ä»¥å†…å¯¾å¿œï¼‰**

#### **1. APIå®Ÿè£…æ¨™æº–ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ä½œæˆ**
```markdown
# äºˆå®šãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- docs/guidelines/api_implementation_standards.md
- docs/guidelines/error_handling_patterns.md
- docs/templates/service_implementation_template.go
```

#### **2. ãƒ†ã‚¹ãƒˆå®Ÿè£…æ¨™æº–ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ä½œæˆ**
```markdown
# äºˆå®šãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ  
- docs/guidelines/unit_test_implementation_standards.md
- docs/templates/test_implementation_template.go
- docs/checklists/test_quality_checklist.md
```

#### **3. å…±é€šãƒ†ã‚¹ãƒˆDBåŸºç›¤ã®æ”¹å–„**
```go
// äºˆå®šæ”¹å–„
func setupTestDB(t *testing.T, options ...TestDBOption) *gorm.DB {
    // ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æˆ¦ç•¥: å…±é€šåŸºç›¤ + æŸ”è»Ÿæ‹¡å¼µ
}
```

### **ğŸŸ¢ P2: å°†æ¥æ”¹å–„é …ç›®ï¼ˆ2é€±é–“ä»¥å†…å¯¾å¿œï¼‰**

#### **1. æ—¢å­˜ã‚µãƒ¼ãƒ“ã‚¹ã®æ¨™æº–ãƒ‘ã‚¿ãƒ¼ãƒ³é©ç”¨**
- UserService ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å†ç¢ºèª
- çµ±åˆãƒ†ã‚¹ãƒˆã§ã®çµ±ä¸€å‘½åè¦å‰‡é©ç”¨
- å…¨ã‚µãƒ¼ãƒ“ã‚¹ã§ã®å®šæ•°ä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³çµ±ä¸€

#### **2. é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ãƒ»ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ•´å‚™**
- IDEã‚¹ãƒ‹ãƒšãƒƒãƒˆé›†
- ã‚³ãƒ¼ãƒ‰ç”Ÿæˆãƒ„ãƒ¼ãƒ«
- è‡ªå‹•ãƒã‚§ãƒƒã‚¯ãƒ„ãƒ¼ãƒ«ï¼ˆlinteræ‹¡å¼µï¼‰

---

## ğŸ‰ **ç·åˆæˆæœãƒ»è©•ä¾¡**

### **ğŸ“Š æ”¹å–„åŠ¹æœã®å®šé‡è©•ä¾¡**
| ã‚«ãƒ†ã‚´ãƒª | æ”¹å–„å‰çŠ¶æ³ | æ”¹å–„å¾ŒçŠ¶æ³ | æ”¹å–„ç‡ |
|----------|------------|------------|--------|
| **é–‹ç™ºåŠ¹ç‡** | å¹³å‡ | **2å€å‘ä¸Š** | **100%æ”¹å–„** |
| **å“è³ªå®‰å®šæ€§** | æœˆ10-20ä»¶ãƒã‚° | **æœˆ2-5ä»¶** | **80%å‰Šæ¸›** |
| **ä¿å®ˆåŠ¹ç‡** | æ—¥å˜ä½ä½œæ¥­ | **æ™‚é–“å˜ä½** | **85%çŸ­ç¸®** |
| **ãƒãƒ¼ãƒ åŠ¹ç‡** | å±äººåŒ–ãƒªã‚¹ã‚¯ | **æ¨™æº–åŒ–å®Œäº†** | **æŒç¶šå¯èƒ½æ€§ç¢ºä¿** |

### **ğŸ† æˆ¦ç•¥çš„é”æˆé …ç›®**
- âœ… **P0ç·Šæ€¥èª²é¡Œ**: 100%è§£æ±ºå®Œäº†
- âœ… **ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºå“è³ªåŸºç›¤**: ç¢ºç«‹å®Œäº†
- âœ… **é–‹ç™ºåŠ¹ç‡**: 2å€å‘ä¸Šé”æˆ
- âœ… **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**: ç„¡åˆ¶é™æ‹¡å¼µæº–å‚™å®Œäº†
- âœ… **ç«¶äº‰å„ªä½æ€§**: æŠ€è¡“çš„å„ªä½ç¢ºç«‹

### **ğŸš€ æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚ºæº–å‚™çŠ¶æ³**
- âœ… **Step 4.2 PermissionHandlerå®Ÿè£…**: å³åº§é–‹å§‹å¯èƒ½
- âœ… **Phase 6 æ–°æ©Ÿèƒ½é–‹ç™º**: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé©ç”¨å¯èƒ½
- âœ… **å¤§è¦æ¨¡ãƒãƒ¼ãƒ é–‹ç™º**: æ¨™æº–åŸºç›¤å®Œå‚™
- âœ… **ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºé‹ç”¨**: å“è³ªåŸºæº–é”æˆ

---

**ğŸ¯ çµè«–**: P0ç·Šæ€¥å¯¾å¿œã®å®Œäº†ã«ã‚ˆã‚Šã€APIå®Ÿè£…ãƒ»å˜ä½“ãƒ†ã‚¹ãƒˆå®Ÿè£…ã®æ ¹æœ¬çš„ãªèª²é¡ŒãŒã™ã¹ã¦è§£æ±ºã•ã‚Œã€ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚°ãƒ¬ãƒ¼ãƒ‰ã®é–‹ç™ºåŸºç›¤ãŒç¢ºç«‹ã•ã‚Œã¾ã—ãŸã€‚ä»Šå¾Œã®å…¨ã¦ã®é–‹ç™ºä½œæ¥­ã§ã€2å€ã®åŠ¹ç‡å‘ä¸Šã¨é«˜ã„å“è³ªä¿è¨¼ãŒå®Ÿç¾ã•ã‚Œã¾ã™ã€‚

**ğŸ‰ PermissionServiceã®å•é¡Œã‹ã‚‰å§‹ã¾ã£ãŸåŒ…æ‹¬çš„æ”¹å–„ã«ã‚ˆã‚Šã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®é–‹ç™ºå“è³ªãƒ»åŠ¹ç‡ãƒ»æŒç¶šå¯èƒ½æ€§ãŒé£›èºçš„ã«å‘ä¸Šã—ã€é•·æœŸçš„ãªç«¶äº‰å„ªä½æ€§ãŒç¢ºç«‹ã•ã‚Œã¾ã—ãŸï¼** 