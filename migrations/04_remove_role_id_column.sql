-- 🔧 マイグレーション: role_idカラム削除
-- 旧の単一ロールシステムから複数ロールシステムへの完全移行

-- =============================================================================
-- インデックス削除
-- =============================================================================

-- role_idを含む複合インデックスを削除
DROP INDEX IF EXISTS idx_users_department_role;

-- =============================================================================
-- カラム削除
-- =============================================================================

-- role_idカラムを削除（外部キー制約も自動的に削除される）
ALTER TABLE users DROP COLUMN IF EXISTS role_id;

-- =============================================================================
-- 確認クエリ
-- =============================================================================

-- 削除後のテーブル構造確認
-- SELECT column_name, data_type, is_nullable 
-- FROM information_schema.columns 
-- WHERE table_name = 'users' 
-- ORDER BY ordinal_position;

-- プライマリロールIDが正しく設定されているか確認
-- SELECT COUNT(*) as users_with_primary_role 
-- FROM users 
-- WHERE primary_role_id IS NOT NULL; 