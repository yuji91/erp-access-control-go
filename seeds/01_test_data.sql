-- テストデータシード
-- 開発・テスト環境用のサンプルデータ
-- 複数ロール対応システムのテスト用データ

-- 部門データ
INSERT INTO departments (id, name, created_at) VALUES
('550e8400-e29b-41d4-a716-446655440001', 'IT部門', NOW()),
('550e8400-e29b-41d4-a716-446655440002', '人事部門', NOW()),
('550e8400-e29b-41d4-a716-446655440003', '営業部門', NOW()),
('550e8400-e29b-41d4-a716-446655440004', '経理部門', NOW())
ON CONFLICT (id) DO NOTHING;

-- ロールデータ（階層構造）
INSERT INTO roles (id, name, parent_id, created_at) VALUES
-- 管理者ロール
('660e8400-e29b-41d4-a716-446655440001', 'システム管理者', NULL, NOW()),
('660e8400-e29b-41d4-a716-446655440002', '部門管理者', '660e8400-e29b-41d4-a716-446655440001', NOW()),
-- 一般ロール
('660e8400-e29b-41d4-a716-446655440003', '一般ユーザー', '660e8400-e29b-41d4-a716-446655440002', NOW()),
('660e8400-e29b-41d4-a716-446655440004', 'ゲストユーザー', '660e8400-e29b-41d4-a716-446655440003', NOW()),
-- 専門ロール
('660e8400-e29b-41d4-a716-446655440005', '開発者', '660e8400-e29b-41d4-a716-446655440002', NOW()),
('660e8400-e29b-41d4-a716-446655440006', 'テスター', '660e8400-e29b-41d4-a716-446655440002', NOW()),
('660e8400-e29b-41d4-a716-446655440007', 'プロジェクトマネージャー', '660e8400-e29b-41d4-a716-446655440002', NOW())
ON CONFLICT (id) DO NOTHING;

-- 権限データ
INSERT INTO permissions (id, module, action, created_at) VALUES
-- ユーザー管理権限
('770e8400-e29b-41d4-a716-446655440001', 'user', 'read', NOW()),
('770e8400-e29b-41d4-a716-446655440002', 'user', 'write', NOW()),
('770e8400-e29b-41d4-a716-446655440003', 'user', 'delete', NOW()),
-- ロール管理権限
('770e8400-e29b-41d4-a716-446655440004', 'role', 'read', NOW()),
('770e8400-e29b-41d4-a716-446655440005', 'role', 'write', NOW()),
('770e8400-e29b-41d4-a716-446655440006', 'role', 'delete', NOW()),
-- 権限管理権限
('770e8400-e29b-41d4-a716-446655440007', 'permission', 'read', NOW()),
('770e8400-e29b-41d4-a716-446655440008', 'permission', 'write', NOW()),
('770e8400-e29b-41d4-a716-446655440009', 'permission', 'delete', NOW()),
-- 部門管理権限
('770e8400-e29b-41d4-a716-446655440010', 'department', 'read', NOW()),
('770e8400-e29b-41d4-a716-446655440011', 'department', 'write', NOW()),
('770e8400-e29b-41d4-a716-446655440012', 'department', 'delete', NOW()),
-- システム管理権限
('770e8400-e29b-41d4-a716-446655440013', 'system', 'read', NOW()),
('770e8400-e29b-41d4-a716-446655440014', 'system', 'write', NOW()),
('770e8400-e29b-41d4-a716-446655440015', 'system', 'admin', NOW()),
-- List権限（一覧取得用）
('770e8400-e29b-41d4-a716-446655440016', 'user', 'list', NOW()),
('770e8400-e29b-41d4-a716-446655440017', 'department', 'list', NOW()),
('770e8400-e29b-41d4-a716-446655440018', 'role', 'list', NOW()),
('770e8400-e29b-41d4-a716-446655440019', 'permission', 'list', NOW()),
-- Create権限（作成用）
('770e8400-e29b-41d4-a716-446655440020', 'user', 'create', NOW()),
('770e8400-e29b-41d4-a716-446655440021', 'department', 'create', NOW()),
('770e8400-e29b-41d4-a716-446655440022', 'role', 'create', NOW()),
('770e8400-e29b-41d4-a716-446655440023', 'permission', 'create', NOW())
ON CONFLICT (id) DO NOTHING;

-- ロール・権限関連付け
INSERT INTO role_permissions (role_id, permission_id, created_at) VALUES
-- システム管理者（全権限）
('660e8400-e29b-41d4-a716-446655440001', '770e8400-e29b-41d4-a716-446655440001', NOW()),
('660e8400-e29b-41d4-a716-446655440001', '770e8400-e29b-41d4-a716-446655440002', NOW()),
('660e8400-e29b-41d4-a716-446655440001', '770e8400-e29b-41d4-a716-446655440003', NOW()),
('660e8400-e29b-41d4-a716-446655440001', '770e8400-e29b-41d4-a716-446655440004', NOW()),
('660e8400-e29b-41d4-a716-446655440001', '770e8400-e29b-41d4-a716-446655440005', NOW()),
('660e8400-e29b-41d4-a716-446655440001', '770e8400-e29b-41d4-a716-446655440006', NOW()),
('660e8400-e29b-41d4-a716-446655440001', '770e8400-e29b-41d4-a716-446655440007', NOW()),
('660e8400-e29b-41d4-a716-446655440001', '770e8400-e29b-41d4-a716-446655440008', NOW()),
('660e8400-e29b-41d4-a716-446655440001', '770e8400-e29b-41d4-a716-446655440009', NOW()),
('660e8400-e29b-41d4-a716-446655440001', '770e8400-e29b-41d4-a716-446655440010', NOW()),
('660e8400-e29b-41d4-a716-446655440001', '770e8400-e29b-41d4-a716-446655440011', NOW()),
('660e8400-e29b-41d4-a716-446655440001', '770e8400-e29b-41d4-a716-446655440012', NOW()),
('660e8400-e29b-41d4-a716-446655440001', '770e8400-e29b-41d4-a716-446655440013', NOW()),
('660e8400-e29b-41d4-a716-446655440001', '770e8400-e29b-41d4-a716-446655440014', NOW()),
('660e8400-e29b-41d4-a716-446655440001', '770e8400-e29b-41d4-a716-446655440015', NOW()),
-- List権限をシステム管理者に割り当て
('660e8400-e29b-41d4-a716-446655440001', '770e8400-e29b-41d4-a716-446655440016', NOW()),
('660e8400-e29b-41d4-a716-446655440001', '770e8400-e29b-41d4-a716-446655440017', NOW()),
('660e8400-e29b-41d4-a716-446655440001', '770e8400-e29b-41d4-a716-446655440018', NOW()),
('660e8400-e29b-41d4-a716-446655440001', '770e8400-e29b-41d4-a716-446655440019', NOW()),
-- Create権限をシステム管理者に割り当て
('660e8400-e29b-41d4-a716-446655440001', '770e8400-e29b-41d4-a716-446655440020', NOW()),
('660e8400-e29b-41d4-a716-446655440001', '770e8400-e29b-41d4-a716-446655440021', NOW()),
('660e8400-e29b-41d4-a716-446655440001', '770e8400-e29b-41d4-a716-446655440022', NOW()),
('660e8400-e29b-41d4-a716-446655440001', '770e8400-e29b-41d4-a716-446655440023', NOW()),

-- 部門管理者（ユーザー・ロール・部門管理権限）
('660e8400-e29b-41d4-a716-446655440002', '770e8400-e29b-41d4-a716-446655440001', NOW()),
('660e8400-e29b-41d4-a716-446655440002', '770e8400-e29b-41d4-a716-446655440002', NOW()),
('660e8400-e29b-41d4-a716-446655440002', '770e8400-e29b-41d4-a716-446655440004', NOW()),
('660e8400-e29b-41d4-a716-446655440002', '770e8400-e29b-41d4-a716-446655440005', NOW()),
('660e8400-e29b-41d4-a716-446655440002', '770e8400-e29b-41d4-a716-446655440010', NOW()),
('660e8400-e29b-41d4-a716-446655440002', '770e8400-e29b-41d4-a716-446655440011', NOW()),

-- 開発者（開発関連権限）
('660e8400-e29b-41d4-a716-446655440005', '770e8400-e29b-41d4-a716-446655440001', NOW()),
('660e8400-e29b-41d4-a716-446655440005', '770e8400-e29b-41d4-a716-446655440004', NOW()),
('660e8400-e29b-41d4-a716-446655440005', '770e8400-e29b-41d4-a716-446655440007', NOW()),
('660e8400-e29b-41d4-a716-446655440005', '770e8400-e29b-41d4-a716-446655440013', NOW()),

-- プロジェクトマネージャー（プロジェクト管理権限）
('660e8400-e29b-41d4-a716-446655440007', '770e8400-e29b-41d4-a716-446655440001', NOW()),
('660e8400-e29b-41d4-a716-446655440007', '770e8400-e29b-41d4-a716-446655440002', NOW()),
('660e8400-e29b-41d4-a716-446655440007', '770e8400-e29b-41d4-a716-446655440004', NOW()),
('660e8400-e29b-41d4-a716-446655440007', '770e8400-e29b-41d4-a716-446655440005', NOW()),
('660e8400-e29b-41d4-a716-446655440007', '770e8400-e29b-41d4-a716-446655440010', NOW()),
('660e8400-e29b-41d4-a716-446655440007', '770e8400-e29b-41d4-a716-446655440011', NOW()),

-- 一般ユーザー（基本権限）
('660e8400-e29b-41d4-a716-446655440003', '770e8400-e29b-41d4-a716-446655440001', NOW()),
('660e8400-e29b-41d4-a716-446655440003', '770e8400-e29b-41d4-a716-446655440004', NOW()),
('660e8400-e29b-41d4-a716-446655440003', '770e8400-e29b-41d4-a716-446655440010', NOW()),

-- ゲストユーザー（閲覧のみ）
('660e8400-e29b-41d4-a716-446655440004', '770e8400-e29b-41d4-a716-446655440001', NOW()),
('660e8400-e29b-41d4-a716-446655440004', '770e8400-e29b-41d4-a716-446655440010', NOW())
ON CONFLICT (role_id, permission_id) DO NOTHING;

-- テストユーザーデータ（パスワード: password123）
INSERT INTO users (id, name, email, password_hash, department_id, primary_role_id, status, created_at, updated_at) VALUES
-- システム管理者
('880e8400-e29b-41d4-a716-446655440001', 'システム管理者', 'admin@example.com', '$2a$10$Lx3PoA7WFGVbH8zqIEY/ZOGveQCGelGRncb9OfGoFbKfgvYM65xWi', '550e8400-e29b-41d4-a716-446655440001', '660e8400-e29b-41d4-a716-446655440001', 'active', NOW(), NOW()),
-- 部門管理者
('880e8400-e29b-41d4-a716-446655440002', 'IT部門長', 'it-manager@example.com', '$2a$10$Lx3PoA7WFGVbH8zqIEY/ZOGveQCGelGRncb9OfGoFbKfgvYM65xWi', '550e8400-e29b-41d4-a716-446655440001', '660e8400-e29b-41d4-a716-446655440002', 'active', NOW(), NOW()),
('880e8400-e29b-41d4-a716-446655440003', '人事部長', 'hr-manager@example.com', '$2a$10$Lx3PoA7WFGVbH8zqIEY/ZOGveQCGelGRncb9OfGoFbKfgvYM65xWi', '550e8400-e29b-41d4-a716-446655440002', '660e8400-e29b-41d4-a716-446655440002', 'active', NOW(), NOW()),
-- 開発者
('880e8400-e29b-41d4-a716-446655440004', '開発者A', 'developer-a@example.com', '$2a$10$Lx3PoA7WFGVbH8zqIEY/ZOGveQCGelGRncb9OfGoFbKfgvYM65xWi', '550e8400-e29b-41d4-a716-446655440001', '660e8400-e29b-41d4-a716-446655440005', 'active', NOW(), NOW()),
('880e8400-e29b-41d4-a716-446655440005', '開発者B', 'developer-b@example.com', '$2a$10$Lx3PoA7WFGVbH8zqIEY/ZOGveQCGelGRncb9OfGoFbKfgvYM65xWi', '550e8400-e29b-41d4-a716-446655440001', '660e8400-e29b-41d4-a716-446655440005', 'active', NOW(), NOW()),
-- プロジェクトマネージャー
('880e8400-e29b-41d4-a716-446655440006', 'PM田中', 'pm-tanaka@example.com', '$2a$10$Lx3PoA7WFGVbH8zqIEY/ZOGveQCGelGRncb9OfGoFbKfgvYM65xWi', '550e8400-e29b-41d4-a716-446655440001', '660e8400-e29b-41d4-a716-446655440007', 'active', NOW(), NOW()),
-- 一般ユーザー
('880e8400-e29b-41d4-a716-446655440007', '一般ユーザーA', 'user-a@example.com', '$2a$10$Lx3PoA7WFGVbH8zqIEY/ZOGveQCGelGRncb9OfGoFbKfgvYM65xWi', '550e8400-e29b-41d4-a716-446655440003', '660e8400-e29b-41d4-a716-446655440003', 'active', NOW(), NOW()),
('880e8400-e29b-41d4-a716-446655440008', '一般ユーザーB', 'user-b@example.com', '$2a$10$Lx3PoA7WFGVbH8zqIEY/ZOGveQCGelGRncb9OfGoFbKfgvYM65xWi', '550e8400-e29b-41d4-a716-446655440004', '660e8400-e29b-41d4-a716-446655440003', 'active', NOW(), NOW()),
-- ゲストユーザー
('880e8400-e29b-41d4-a716-446655440009', 'ゲストユーザー', 'guest@example.com', '$2a$10$Lx3PoA7WFGVbH8zqIEY/ZOGveQCGelGRncb9OfGoFbKfgvYM65xWi', '550e8400-e29b-41d4-a716-446655440001', '660e8400-e29b-41d4-a716-446655440004', 'active', NOW(), NOW())
ON CONFLICT (id) DO NOTHING;

-- 複数ロール割り当てテストデータ
INSERT INTO user_roles (id, user_id, role_id, valid_from, valid_to, priority, is_active, assigned_by, assigned_reason, created_at, updated_at) VALUES
-- システム管理者（複数ロール）
('990e8400-e29b-41d4-a716-446655440001', '880e8400-e29b-41d4-a716-446655440001', '660e8400-e29b-41d4-a716-446655440001', NOW(), NULL, 1, true, '880e8400-e29b-41d4-a716-446655440001', '初期設定', NOW(), NOW()),
('990e8400-e29b-41d4-a716-446655440002', '880e8400-e29b-41d4-a716-446655440001', '660e8400-e29b-41d4-a716-446655440002', NOW(), NULL, 2, true, '880e8400-e29b-41d4-a716-446655440001', '部門管理権限追加', NOW(), NOW()),

-- 開発者A（複数ロール）
('990e8400-e29b-41d4-a716-446655440003', '880e8400-e29b-41d4-a716-446655440004', '660e8400-e29b-41d4-a716-446655440005', NOW(), NULL, 1, true, '880e8400-e29b-41d4-a716-446655440002', '開発者ロール割り当て', NOW(), NOW()),
('990e8400-e29b-41d4-a716-446655440004', '880e8400-e29b-41d4-a716-446655440004', '660e8400-e29b-41d4-a716-446655440006', NOW(), NOW() + INTERVAL '30 days', 2, true, '880e8400-e29b-41d4-a716-446655440002', '一時的テスター権限', NOW(), NOW()),

-- 開発者B（期限付きロール）
('990e8400-e29b-41d4-a716-446655440005', '880e8400-e29b-41d4-a716-446655440005', '660e8400-e29b-41d4-a716-446655440005', NOW(), NULL, 1, true, '880e8400-e29b-41d4-a716-446655440002', '開発者ロール割り当て', NOW(), NOW()),
('990e8400-e29b-41d4-a716-446655440006', '880e8400-e29b-41d4-a716-446655440005', '660e8400-e29b-41d4-a716-446655440007', NOW(), NOW() + INTERVAL '90 days', 2, true, '880e8400-e29b-41d4-a716-446655440002', 'プロジェクト期間限定PM権限', NOW(), NOW()),

-- 一般ユーザーA（基本ロール）
('990e8400-e29b-41d4-a716-446655440007', '880e8400-e29b-41d4-a716-446655440007', '660e8400-e29b-41d4-a716-446655440003', NOW(), NULL, 1, true, '880e8400-e29b-41d4-a716-446655440002', '一般ユーザーロール割り当て', NOW(), NOW()),

-- 一般ユーザーB（基本ロール）
('990e8400-e29b-41d4-a716-446655440008', '880e8400-e29b-41d4-a716-446655440008', '660e8400-e29b-41d4-a716-446655440003', NOW(), NULL, 1, true, '880e8400-e29b-41d4-a716-446655440003', '一般ユーザーロール割り当て', NOW(), NOW()),

-- ゲストユーザー（基本ロール）
('990e8400-e29b-41d4-a716-446655440009', '880e8400-e29b-41d4-a716-446655440009', '660e8400-e29b-41d4-a716-446655440004', NOW(), NULL, 1, true, '880e8400-e29b-41d4-a716-446655440002', 'ゲストユーザーロール割り当て', NOW(), NOW())
ON CONFLICT (id) DO NOTHING;

-- コメント
COMMENT ON TABLE departments IS 'テストデータ投入完了 - 部門情報';
COMMENT ON TABLE roles IS 'テストデータ投入完了 - ロール情報（階層構造）';
COMMENT ON TABLE permissions IS 'テストデータ投入完了 - 権限情報';
COMMENT ON TABLE role_permissions IS 'テストデータ投入完了 - ロール・権限関連付け';
COMMENT ON TABLE users IS 'テストデータ投入完了 - ユーザー情報';
COMMENT ON TABLE user_roles IS 'テストデータ投入完了 - ユーザー・ロール関連付け（複数ロール対応）'; 